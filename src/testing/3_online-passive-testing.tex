\section{Online passive testing}
\label{sec:testing:online}

Our online passive testing technique, which aims to check whether
the two previous implementation relations hold, is given in
Algorithms \ref{algo:online-entry-point} and
\ref{algo:check-online}. The latter also takes the same models
$R(\EuScript{S}^{N})$ and $D(\EuScript{S}^{N})$, with regards to
Proposition \ref{rel:impl12} and Proposition \ref{rel:impl2}, and
it returns the same verdicts "Pass$\leq_{ct}$" or
"Pass$\leq_{mct}$" whether the relations $\leq_{ct}$ or
$\leq_{mct}$ are satisfied.

In online mode, we do not have complete traces (such as
$CTraces({Sut})$), but traces that are constructed on-the-fly by
an instance of tester, every time an event is received. Each new
production event passes through an \emph{entry point} whose role
is to distribute the incoming events across the different
instances. The entry point functioning is given in Algorithm
\ref{algo:online-entry-point}. Each event is filtered and
transformed into a filtered valued event (line
\ref{algo:oep:line:filter}), from which we extract its product
identifier $pid$ (line \ref{algo:oep:line:extract}).  The valued
event is then forwarded to the right tester (line
\ref{algo:oep:line:fw}), \emph{i.e.} the instance for this $pid$.
If there is no instance yet, we create a new tester for this
$pid$ first (lines
\ref{algo:oep:line:new}-\ref{algo:oep:line:endnew}).

\begin{algorithm}[h]
    BEGIN\;

    $Instances = \emptyset$\;

    \While{production event $event$}{
        transform $event$ into a valued event
        $a(\alpha)$\;\label{algo:oep:line:filter}

        extract the product identifier $pid'$ from
        $a(\alpha)$\;\label{algo:oep:line:extract}

        \If{$\not\exists ~instance_{pid} \in Instances \mid pid
        == pid'$}{\label{algo:oep:line:new}
            create new tester $instance_{pid}$ with $pid = pid'$\;
            $Instances = Instances \cup \{ instance_{pid} \}$\;
        }\label{algo:oep:line:endnew}

        forward $a(\alpha)$ to $instance_{pid}$\;\label{algo:oep:line:fw}
    }

    END\;

    \caption{Online passive testing entry point}
    \label{algo:online-entry-point}
\end{algorithm}

At this point, there should be one instance of tester running the
same Algorithm \ref{algo:check-online} per $pid$, \emph{i.e.} per
product being manufactured. We start by constructing a trace with
the incoming valued events. Then we check its conformance over
the models $R(\EuScript{S}^{N})$ and $D(\EuScript{S}^{N})$.

\begin{algorithm}[h]
    \SetKwInOut{Input}{Input}
    \SetKwInOut{Output}{Output}
    \SetKwFunction{check}{check}

    \Input{$R(\EuScript{S}^{N}), D(\EuScript{S}^{N})$, valued
    events $a(\alpha)$ sent by the entry point}
    \Output{Verdicts and/or possibly fail trace sets $T_1, T_2$ }

    BEGIN\;
    $trace = \emptyset$\;

    \While{valued event $a(\alpha)$}{
        $trace = trace \cup a(\alpha)$\;

        \TODO{algorithm is missing}
    }

    END\;

    \caption{Online passive testing algorithm}
    \label{algo:check-online}
\end{algorithm}
